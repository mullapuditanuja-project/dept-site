<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Department Website Content Manager</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 20px;
      background: #f5f5f5;
    }
    h1 { margin-bottom: 10px; }
    nav button {
      margin-right: 8px;
      padding: 8px 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
      cursor: pointer;
    }
    nav button.active {
      background: #333;
      color: white;
    }
    .card, .panel {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      cursor: pointer;
    }
    img.preview {
      max-width: 120px;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(240px,1fr));
      gap: 15px;
    }
    iframe {
      width: 100%;
      height: 600px;
      border: 1px solid #ccc;
      background: white;
    }
  </style>
</head>
<body>

<h1>Department Website Content Manager</h1>

<div style="margin-bottom:15px;">
  <button onclick="showPreview()">Preview</button>
  <button onclick="downloadHTML()">Publish → Download HTML</button>
</div>

<nav>
  <button id="tab-dashboard" class="active" onclick="switchTab('dashboard')">Dashboard</button>
  <button id="tab-faculty" onclick="switchTab('faculty')">Faculty</button>
  <button id="tab-content" onclick="switchTab('content')">Achievements / Events / Labs</button>
  <button id="tab-gallery" onclick="switchTab('gallery')">Gallery</button>
  <button id="tab-ann" onclick="switchTab('ann')">Announcements</button>
</nav>

<div id="content-area"></div>

<script>
/* ----------------- State ----------------- */
let faculty = JSON.parse(localStorage.getItem("dept_faculty") || "[]");
let achievements = JSON.parse(localStorage.getItem("dept_achievements") || "[]");
let events = JSON.parse(localStorage.getItem("dept_events") || "[]");
let labs = JSON.parse(localStorage.getItem("dept_labs") || "[]");
let gallery = JSON.parse(localStorage.getItem("dept_gallery") || "[]");
let announcements = JSON.parse(localStorage.getItem("dept_ann") || "[]");

function saveAll() {
  localStorage.setItem("dept_faculty", JSON.stringify(faculty));
  localStorage.setItem("dept_achievements", JSON.stringify(achievements));
  localStorage.setItem("dept_events", JSON.stringify(events));
  localStorage.setItem("dept_labs", JSON.stringify(labs));
  localStorage.setItem("dept_gallery", JSON.stringify(gallery));
  localStorage.setItem("dept_ann", JSON.stringify(announcements));
}

function id() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2);
}

/* ----------------- Tabs ----------------- */
let currentTab = "dashboard";
function switchTab(t) {
  currentTab = t;
  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  document.getElementById("tab-" + t).classList.add("active");
  render();
}

function render() {
  const area = document.getElementById("content-area");
  area.innerHTML = "";
  if (currentTab === "dashboard") return renderDashboard();
  if (currentTab === "faculty") return renderFaculty();
  if (currentTab === "content") return renderContent();
  if (currentTab === "gallery") return renderGallery();
  if (currentTab === "ann") return renderAnnouncements();
}

function renderDashboard() {
  document.getElementById("content-area").innerHTML = `
    <div class="grid">
      <div class="card"><h3>Faculty Count</h3><p>${faculty.length}</p></div>
      <div class="card"><h3>Announcements</h3><p>${announcements.length}</p></div>
      <div class="card"><h3>Gallery Images</h3><p>${gallery.length}</p></div>
    </div>
  `;
}

/* ----------------- Faculty ----------------- */
let editingFaculty = null;

function renderFaculty() {
  const area = document.getElementById("content-area");
  area.innerHTML = `
    <div class="grid">
      <div class="panel">
        <h3>${editingFaculty ? "Edit Faculty" : "Add Faculty"}</h3>
        <input id="f-name" placeholder="Name">
        <input id="f-title" placeholder="Title">
        <input id="f-email" placeholder="Email">
        <textarea id="f-bio" placeholder="Bio"></textarea>
        <input type="file" id="f-photo">
        <img id="f-preview" class="preview" style="display:none;">

        <button onclick="saveFaculty()">Save</button>
        <button onclick="resetFacultyForm()">Reset</button>
      </div>

      <div>
        <h3>Faculty List</h3>
        ${faculty.map(f => `
          <div class="card">
            <img src="${f.photo || ''}" class="preview">
            <h4>${f.name}</h4>
            <p>${f.title} • ${f.email}</p>
            <p>${f.bio}</p>
            <button onclick="editFaculty('${f.id}')">Edit</button>
            <button onclick="deleteFaculty('${f.id}')">Delete</button>
          </div>
        `).join("")}
      </div>
    </div>
  `;

  if (editingFaculty) {
    document.getElementById("f-name").value = editingFaculty.name;
    document.getElementById("f-title").value = editingFaculty.title;
    document.getElementById("f-email").value = editingFaculty.email;
    document.getElementById("f-bio").value = editingFaculty.bio;
    if (editingFaculty.photo) {
      const img = document.getElementById("f-preview");
      img.src = editingFaculty.photo;
      img.style.display = "block";
    }
  }

  document.getElementById("f-photo").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      editingFaculty = editingFaculty || {};
      editingFaculty.photo = reader.result;
      const img = document.getElementById("f-preview");
      img.src = reader.result;
      img.style.display = "block";
    };
    reader.readAsDataURL(file);
  });
}

function saveFaculty() {
  const name = document.getElementById("f-name").value;
  if (!name) return alert("Name required");

  const data = {
    id: editingFaculty ? editingFaculty.id : id(),
    name,
    title: document.getElementById("f-title").value,
    email: document.getElementById("f-email").value,
    bio: document.getElementById("f-bio").value,
    photo: editingFaculty?.photo || null,
  };

  if (editingFaculty) {
    faculty = faculty.map(f => f.id === editingFaculty.id ? data : f);
  } else faculty.unshift(data);

  saveAll();
  editingFaculty = null;
  renderFaculty();
}

function editFaculty(fid) {
  editingFaculty = faculty.find(f => f.id === fid);
  switchTab("faculty");
}

function deleteFaculty(fid) {
  if (!confirm("Delete?")) return;
  faculty = faculty.filter(f => f.id !== fid);
  saveAll();
  renderFaculty();
}

function resetFacultyForm() {
  editingFaculty = null;
  renderFaculty();
}

/* ----------------- Content (Achievements / Events / Labs) ----------------- */
function renderContent() {
  document.getElementById("content-area").innerHTML = `
    <div class="grid">
      <div class="panel">
        <h3>Achievements</h3>
        <input id="ach-title" placeholder="Title">
        <textarea id="ach-desc" placeholder="Description"></textarea>
        <button onclick="addAchievement()">Add</button>
        <hr>
        ${achievements.map(i => `
          <p>${i.title} - ${i.desc}
            <button onclick="delAchievement('${i.id}')">Delete</button>
          </p>
        `).join("")}
      </div>

      <div class="panel">
        <h3>Events</h3>
        <input id="ev-title" placeholder="Event Title">
        <input id="ev-date" type="date">
        <textarea id="ev-desc" placeholder="Description"></textarea>
        <button onclick="addEvent()">Add</button>
        <hr>
        ${events.map(i => `
          <p>${i.title} (${i.date}) - ${i.desc}
            <button onclick="delEvent('${i.id}')">Delete</button>
          </p>
        `).join("")}
      </div>

      <div class="panel">
        <h3>Labs</h3>
        <input id="lab-title" placeholder="Lab Name">
        <textarea id="lab-desc" placeholder="Description"></textarea>
        <button onclick="addLab()">Add</button>
        <hr>
        ${labs.map(i => `
          <p>${i.name} - ${i.desc}
            <button onclick="delLab('${i.id}')">Delete</button>
          </p>
        `).join("")}
      </div>
    </div>
  `;
}

function addAchievement() {
  achievements.unshift({
    id: id(),
    title: document.getElementById("ach-title").value,
    desc: document.getElementById("ach-desc").value
  });
  saveAll(); renderContent();
}
function delAchievement(i) { achievements = achievements.filter(a=>a.id!==i); saveAll(); renderContent(); }

function addEvent() {
  events.unshift({
    id: id(),
    title: document.getElementById("ev-title").value,
    date: document.getElementById("ev-date").value,
    desc: document.getElementById("ev-desc").value
  });
  saveAll(); renderContent();
}
function delEvent(i) { events = events.filter(a=>a.id!==i); saveAll(); renderContent(); }

function addLab() {
  labs.unshift({
    id: id(),
    name: document.getElementById("lab-title").value,
    desc: document.getElementById("lab-desc").value
  });
  saveAll(); renderContent();
}
function delLab(i) { labs = labs.filter(a=>a.id!==i); saveAll(); renderContent(); }

/* ----------------- Gallery ----------------- */
function renderGallery() {
  document.getElementById("content-area").innerHTML = `
    <div class="panel">
      <h3>Upload Images</h3>
      <input type="file" multiple id="gal-upload">
    </div>

    <div class="grid">
      ${gallery.map(g => `
        <div class="card">
          <img src="${g.dataUrl}" class="preview">
          <button onclick="delGallery('${g.id}')">Delete</button>
        </div>
      `).join("")}
    </div>
  `;

  document.getElementById("gal-upload").addEventListener("change", e => {
    const files = [...e.target.files];
    files.forEach(f => {
      const reader = new FileReader();
      reader.onload = () => {
        gallery.unshift({ id: id(), name: f.name, dataUrl: reader.result });
        saveAll(); renderGallery();
      };
      reader.readAsDataURL(f);
    });
  });
}

function delGallery(i) {
  if (!confirm("Delete?")) return;
  gallery = gallery.filter(g => g.id !== i);
  saveAll(); renderGallery();
}

/* ----------------- Announcements ----------------- */
function renderAnnouncements() {
  document.getElementById("content-area").innerHTML = `
    <div class="grid">
      <div class="panel">
        <h3>New Announcement</h3>
        <input id="ann-title" placeholder="Title">
        <textarea id="ann-body" placeholder="Body"></textarea>
        <button onclick="addAnnouncement()">Add</button>
      </div>

      <div class="panel">
        <h3>Announcements</h3>
        ${announcements.map(a => `
          <p><b>${a.title}</b><br>${a.body}
            <button onclick="delAnnouncement('${a.id}')">Delete</button>
          </p>
        `).join("")}
      </div>
    </div>
  `;
}

function addAnnouncement() {
  announcements.unshift({
    id: id(),
    title: document.getElementById("ann-title").value,
    body: document.getElementById("ann-body").value
  });
  saveAll(); renderAnnouncements();
}
function delAnnouncement(i) { announcements = announcements.filter(a=>a.id!==i); saveAll(); renderAnnouncements(); }

/* ----------------- Preview + Publish ----------------- */
function generateStaticHTML() {
  return `
<!DOCTYPE html><html><head>
<meta charset="UTF-8"><title>Department Website</title>
<style>
body{font-family:Arial;padding:20px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:15px;}
.card{padding:10px;border:1px solid #ddd;border-radius:8px;}
img{max-width:150px;border-radius:8px;}
</style>
</head><body>

<h1>Department Website</h1>

<h2>Announcements</h2>
<ul>
${announcements.map(a => `<li><b>${a.title}</b> — ${a.body}</li>`).join("")}
</ul>

<h2>Faculty</h2>
<div class="grid">
${faculty.map(f => `
  <div class="card">
    <img src="${f.photo||''}">
    <h3>${f.name}</h3>
    <p><b>${f.title}</b></p>
    <p>${f.email}</p>
    <p>${f.bio}</p>
  </div>
`).join("")}
</div>

<h2>Achievements</h2>
<ul>${achievements.map(a => `<li><b>${a.title}</b> — ${a.desc}</li>`).join("")}</ul>

<h2>Events</h2>
<ul>${events.map(e => `<li><b>${e.title}</b> (${e.date}) — ${e.desc}</li>`).join("")}</ul>

<h2>Labs</h2>
<ul>${labs.map(l => `<li><b>${l.name}</b> — ${l.desc}</li>`).join("")}</ul>

<h2>Gallery</h2>
${gallery.map(g => `<img src="${g.dataUrl}" style="max-width:200px;margin:8px;">`).join("")}

</body></html>
`;
}

function showPreview() {
  const area = document.getElementById("content-area");
  area.innerHTML = `
    <h2>Preview</h2>
    <iframe srcdoc="${generateStaticHTML().replace(/"/g, '&quot;')}"></iframe>
  `;
}

function downloadHTML() {
  const blob = new Blob([generateStaticHTML()], { type: "text/html" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "department-site.html";
  a.click();
  URL.revokeObjectURL(url);
}
</script>

<script>render();</script>

</body>
</html>
